<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add New Book - Library Management System</title>
    <script
      src="https://unpkg.com/htmx.org@2.0.2"
      integrity="sha384-Y7hw+L/jvKeWIRRkqWYfPcvVxHzVzn5REgzbawhxAuQGwX1XWe70vji+VSeHOThJ"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css"
      integrity="sha512-dPXYcDub/aeb08c63jRq/k6GaKccl256JQy/AnOq7CAnEZ9FzSL9wSbcZkMp4R26vBsMLFYH4kQ67/bbV8XaCQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>

    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/global.css}" />
  </head>
  <body>
    <nav th:replace="~{fragments/nav}"></nav>
    <div id="add-book" class="container" style="padding-top: 80px">
      <div class="card" style="background-color: #222d3a; display: block">
        <a th:href="@{/book/search}" class="bg6-btn mt-3 ms-3">
          <i class="bi bi-arrow-left"></i> Back to Home Page
        </a>
        <div class="card-header text-center">
          <i class="bi bi-book-half" style="font-size: 3rem; color: white"></i>
          <h2 class="text-light">Add New Book</h2>
        </div>
        <div th:if="${param.success}" class="alert alert-success" role="alert">
          Book added successfully!
        </div>
        <div class="card-body p-4 p-md-5">
          <form
            th:action="@{/book/add}"
            method="post"
            th:object="${addBookForm}"
          >
            <div class="row g-4">
              <div class="col-md-4">
                <label for="title" class="form-label">Title*</label>
                <input
                  type="text"
                  class="form-control"
                  name="title"
                  th:value="*{title}"
                  placeholder="Enter book title"
                />
              </div>
              <div class="col-md-4">
                <label for="author" class="form-label">Author*</label>
                <input
                  type="text"
                  class="form-control"
                  name="author"
                  th:value="*{author}"
                  placeholder="Enter author name"
                />
              </div>
              <div class="col-md-4">
                <label for="isbn" class="form-label">ISBN*</label>
                <input
                  type="text"
                  class="form-control"
                  name="isbn"
                  th:value="*{isbn}"
                  placeholder="Enter ISBN"
                />
              </div>
              <div class="col-md-4">
                <label for="language" class="form-label">Language</label>
                <input
                  type="text"
                  class="form-control"
                  name="language"
                  th:value="*{language}"
                  placeholder="Enter language"
                />
              </div>
              <div class="col-md-4">
                <label for="book_format" class="form-label">Book Format</label>
                <input
                  type="text"
                  class="form-control"
                  name="bookFormat"
                  th:value="*{bookFormat}"
                  placeholder="E.g., Hardcover, Paperback, E-book"
                />
              </div>
              <div class="col-md-4">
                <label for="pages" class="form-label">Pages</label>
                <input
                  type="number"
                  class="form-control"
                  name="pages"
                  th:value="*{pages}"
                  min="0"
                  placeholder="Enter number of pages"
                />
              </div>
              <div class="col-md-4">
                <label for="price" class="form-label">Price</label>
                <input
                  type="number"
                  class="form-control"
                  name="price"
                  th:value="*{price}"
                  step="0.01"
                  min="0"
                  placeholder="Enter price"
                />
              </div>
              <div class="col-md-4">
                <label for="cover_img" class="form-label"
                  >Cover Image URL</label
                >
                <input
                  type="url"
                  class="form-control"
                  name="coverImg"
                  th:value="*{coverImg}"
                  placeholder="Enter cover image URL"
                />
              </div>
              <div class="col-md-4">
                <label for="publicationYear" class="form-label"
                  >Publication Year</label
                >
                <input
                  type="number"
                  min="1000"
                  max="2024"
                  class="form-control"
                  name="publicationYear"
                  th:value="*{publicationYear}"
                  placeholder="Enter publication year"
                />
              </div>
              <div class="col-md-4">
                <label for="quantity" class="form-label">Quantity</label>
                <input
                  type="text"
                  class="form-control"
                  name="quantity"
                  th:value="*{quantity}"
                  placeholder="Enter quantity"
                />
              </div>
              <div class="col-md-4">
                <label for="genreSelectBtn" class="form-label">Genres:</label>
                <input
                  type="hidden"
                  id="genreSelect"
                  name="genres"
                  th:value="*{genres}"
                />
                <select
                  id="genreSelectBtn"
                  multiple="multiple"
                  class="form-control"
                >
                  <option
                    th:each="genre : ${genres}"
                    th:value="${genre}"
                    th:text="${genre}"
                    th:selected="${selectedGenres != null and selectedGenres.contains(genre)}"
                  ></option>
                </select>
              </div>
            </div>
            <div class="col-12 text-center mt-4">
              <button type="submit" class="btn btn-primary">Add Book</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      // Set the global scroll behavior for HTMX
      htmx.config.scrollBehavior = "smooth";

      // HTMX onLoad event
      htmx.onLoad(function () {
        $("#genreSelectBtn").select2({
          selectionCssClass: "genreSelectBtn",
          tags: true, // Enable tagging
          tokenSeparators: [",", " "], // Optional: allows space and comma to separate tags
          createTag: function (params) {
            var term = $.trim(params.term);
            // Prevent empty tag creation
            if (term === "") {
              return null;
            }
            return {
              id: term,
              text: term,
              newTag: true, // Mark as a new tag
            };
          },
          insertTag: function (data, tag) {
            // Insert the tag at the end of the results
            data.push(tag);
          },
        });

        // Synchronize the selected values with the hidden input
        $("#genreSelectBtn").on("change", function () {
          // Get the selected values as an array
          const selectedGenres = $(this).val();
          // Update the hidden input value as a comma-separated string
          $("#genreSelect").val(selectedGenres.join(","));
        });
      });
    </script>
  </body>
</html>
